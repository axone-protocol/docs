"use strict";(self.webpackChunk_okp4_docs=self.webpackChunk_okp4_docs||[]).push([[64530],{19005:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>t,readingTime:()=>l,toc:()=>c});var o=s(85893),i=s(11151);const r={sidebar_position:4},a="Upgrade",t={id:"nodes/upgrade",title:"Upgrade",description:"For public networks, it is recommended to use Cosmovisor to run your node.",source:"@site/docs/nodes/upgrade.md",sourceDirName:"nodes",slug:"/nodes/upgrade",permalink:"/fr/nodes/upgrade",draft:!1,unlisted:!1,editUrl:"https://github.com/okp4/docs/edit/main/docs/nodes/upgrade.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"nodes",previous:{title:"Running a node",permalink:"/fr/nodes/run-node"},next:{title:"Validator Security Checklist",permalink:"/fr/nodes/security"}},d={},l=3,c=[{value:"Setup Cosmovisor",id:"setup-cosmovisor",level:2},{value:"Install",id:"install",level:3},{value:"GitHub Releases",id:"github-releases",level:4},{value:"Build from source",id:"build-from-source",level:4},{value:"\u2699\ufe0f Init",id:"\ufe0f-init",level:3},{value:"Create Service",id:"create-service",level:3},{value:"\ud83d\ude80 Start Service",id:"-start-service",level:3},{value:"Download binaries",id:"download-binaries",level:4},{value:"Start",id:"start",level:4}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"upgrade",children:"Upgrade"}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["For public networks, it is recommended to use ",(0,o.jsx)(n.a,{href:"https://docs.cosmos.network/main/tooling/cosmovisor",children:"Cosmovisor"})," to run your node."]})}),"\n",(0,o.jsx)(n.p,{children:"Cosmovisor is a tool to automate Cosmos SDK node binaries upgrade tasks. By monitoring the governance module it'll be able to download the new binaries ahead of time for chain upgrades, by avoiding manual operations it can be a precious help on stressful ops tasks."}),"\n",(0,o.jsx)(n.h2,{id:"setup-cosmovisor",children:"Setup Cosmovisor"}),"\n",(0,o.jsx)(n.h3,{id:"install",children:"Install"}),"\n",(0,o.jsx)(n.h4,{id:"github-releases",children:"GitHub Releases"}),"\n",(0,o.jsxs)(n.p,{children:["The recommended way to install Cosmovisor is by downloading it from an official ",(0,o.jsx)(n.a,{href:"https://github.com/cosmos/cosmos-sdk/releases?q=cosmovisor&expanded=true",children:"GitHub release"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"curl --fail --progress-bar -L https://github.com/cosmos/cosmos-sdk/releases/download/cosmovisor%2Fv1.2.0/cosmovisor-v1.2.0-${OS}-${ARCH}.tar.gz \\\n    | tar -zxf - -C /usr/local/bin\n"})}),"\n",(0,o.jsx)(n.p,{children:"To find out the binary that'll fit your platform:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# find OS\ncase `uname -s` in\nDarwin) OS="darwin";;\nLinux) OS="linux";;\n*) echo "Error: unknown os: $(uname -s)";;\nesac\n\n# find ARCH\ncase `uname -m` in\narm64) ARCH="arm64";;\nx86_64) ARCH="amd64";;\n*) echo "Error: unknown arch: $(uname -m)";;\nesac\n'})}),"\n",(0,o.jsx)(n.h4,{id:"build-from-source",children:"Build from source"}),"\n",(0,o.jsx)(n.p,{children:"You can also build from source:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"go install github.com/cosmos/cosmos-sdk/cosmovisor/cmd/cosmovisor@latest\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-init",children:"\u2699\ufe0f Init"}),"\n",(0,o.jsx)(n.p,{children:"The following environment variables will simply indicate its home and the daemon name to Cosmovisor:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cat << EOF >> ~/.profile\n# Cosmovisor\nexport DAEMON_NAME=okp4d\nexport DAEMON_HOME=$HOME/.okp4d\nEOF\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"It could be relevant to create a dedicated user to cosmovisor."})}),"\n",(0,o.jsx)(n.p,{children:"We can now initialize Cosmovisor with:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cosmovisor init $(which okp4d)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"create-service",children:"Create Service"}),"\n",(0,o.jsx)(n.p,{children:"You'll need to keep the process always running in background, on Linux you can create a service as follow:"}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["A description of the different environment variables can be found ",(0,o.jsx)(n.a,{href:"https://docs.cosmos.network/master/run-node/cosmovisor.html#command-line-arguments-and-environment-variables",children:"here"}),"."]})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'cat << EOF >> /etc/systemd/system/okp4d.service\n[Unit]\nDescription=OKP4 Daemon (cosmovisor)\nAfter=network-online.target\n\n[Service]\nUser=$USER\nExecStart=$(which cosmovisor) start\nRestart=always\nRestartSec=3\nLimitNOFILE=4096\nEnvironment="DAEMON_NAME=okp4d"\nEnvironment="$HOME/.okp4d"\nEnvironment="DAEMON_ALLOW_DOWNLOAD_BINARIES=false"\nEnvironment="DAEMON_RESTART_AFTER_UPGRADE=true"\n\n[Install]\nWantedBy=multi-user.target\nEOF\n'})}),"\n",(0,o.jsxs)(n.admonition,{title:"Auto-download",type:"caution",children:[(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"DAEMON_ALLOW_DOWNLOAD_BINARIES"})," variable is set to ",(0,o.jsx)(n.code,{children:"false"})," to disable auto-download."]}),(0,o.jsx)(n.p,{children:"Cosmovisor doesn't verify in advance if a binary is available before downloading, and if there is any issue downloading a binary, cosmovisor will stop and won't restart, which could lead to a halt."})]}),"\n",(0,o.jsx)(n.h3,{id:"-start-service",children:"\ud83d\ude80 Start Service"}),"\n",(0,o.jsx)(n.h4,{id:"download-binaries",children:"Download binaries"}),"\n",(0,o.jsxs)(n.p,{children:["If the auto-download of binary updates is disabled, which is recommended, all the binaries shall be manually downloaded uphill by node operators, and placed in the ",(0,o.jsx)(n.code,{children:"$DAEMON_HOME"})," respecting the following structure:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cosmovisor/\n\u251c\u2500\u2500 current/\n\u251c\u2500\u2500 genesis\n\u2502   \u2514\u2500\u2500 bin\n\u2502       \u2514\u2500\u2500 okp4d\n\u2514\u2500\u2500 upgrades\n    \u2514\u2500\u2500 v3.0.0\n        \u251c\u2500\u2500 bin\n        \u2502   \u2514\u2500\u2500 okp4d\n        \u2514\u2500\u2500 upgrade-info.json\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["The network's upgrades can be found in their respective sections (i.e. ",(0,o.jsx)(n.a,{href:"/fr/nodes/join-testnet#upgrades",children:"Join Testnet"})," & ",(0,o.jsx)(n.a,{href:"/fr/nodes/join-mainnet#upgrades",children:"Join Mainnet"}),")."]})}),"\n",(0,o.jsx)(n.h4,{id:"start",children:"Start"}),"\n",(0,o.jsx)(n.p,{children:"Now that everything is setup and ready to go, you can start the service:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo -S systemctl daemon-reload\nsudo -S systemctl enable okp4d\nsudo systemctl start okp4d\n"})}),"\n",(0,o.jsx)(n.p,{children:"You can check the service status with:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo systemctl status okp4d\n"})}),"\n",(0,o.jsx)(n.p,{children:"To monitor the running service, you can inspect the logs with:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"journalctl -fu okp4d\n"})})]})}function u(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>t,a:()=>a});var o=s(67294);const i={},r=o.createContext(i);function a(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);